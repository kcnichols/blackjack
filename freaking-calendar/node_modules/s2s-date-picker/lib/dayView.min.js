'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _s2sBaseClass=require('s2s-base-class');var _s2sBaseClass2=_interopRequireDefault(_s2sBaseClass);var _cell=require('./cell');var _cell2=_interopRequireDefault(_cell);var _classnames=require('classnames');var _classnames2=_interopRequireDefault(_classnames);var _viewHeader=require('./viewHeader');var _viewHeader2=_interopRequireDefault(_viewHeader);var _moment=require('moment');var _moment2=_interopRequireDefault(_moment);var _immutable=require('immutable');var _styles=require('./styles.js');var _styles2=_interopRequireDefault(_styles);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}// Day View is a normal calendar.
var DayView=function(_S2SBaseComponent){_inherits(DayView,_S2SBaseComponent);function DayView(props){_classCallCheck(this,DayView);var _this=_possibleConstructorReturn(this,(DayView.__proto__||Object.getPrototypeOf(DayView)).call(this,props));_this.displayName='DayView';_this.state={'selectedDate':false};_this.moment=(0,_moment2.default)();_this.prev=_this.prev.bind(_this);_this.next=_this.next.bind(_this);_this.cellClick=_this.cellClick.bind(_this);_this.daysOnKeyPress=_this.daysOnKeyPress.bind(_this);_this.handleTitleClick=_this.handleTitleClick.bind(_this);_this.currentDate=_this.props.dateVal?_this.props.dateVal.format('MMMM YYYY'):_this.moment.format('MMMM YYYY');_this.prefetchStyles();return _this}_createClass(DayView,[{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){if(nextProps.hasOwnProperty('dateVal')){this.currentDate=nextProps.dateVal?nextProps.dateVal.format('MMMM YYYY'):this.moment.format('MMMM YYYY')}}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(nextProps,nextState){return!(0,_immutable.fromJS)(nextProps).equals((0,_immutable.fromJS)(this.props))||!(0,_immutable.fromJS)(nextState).equals((0,_immutable.fromJS)(this.state))}},{key:'getDefaultStyle',value:function getDefaultStyle(styleName,objectPropState){return(0,_styles2.default)(styleName,objectPropState)}},{key:'cellClick',value:function cellClick(e){var cell=e.target;var date=parseInt(cell.innerHTML,10);var newDate=this.props.dateVal?this.props.dateVal.clone():this.moment;if(isNaN(date))return;if(cell.className.indexOf('prev')>-1){newDate.subtract(1,'months')}else if(cell.className.indexOf('next')>-1){newDate.add(1,'months')}newDate.date(date);this.props.cbSetDate(newDate,true)}},{key:'getDays',value:function getDays(){var now=this.props.dateVal?this.props.dateVal:this.moment;var start=now.clone().startOf('month').weekday(0);var end=now.clone().endOf('month').weekday(6);var minDate=this.props.minDate;var maxDate=this.props.maxDate;var month=now.month();var today=this.moment;var currDay=now.date();var year=now.year();var days=[];this.moment.range(start,end).by('days',function(day){days.push({label:day.format('D'),prev:day.month()<month&&!(day.year()>year)||day.year()<year,next:day.month()>month||day.year()>year,disabled:day.isBefore(minDate,'day')||day.isAfter(maxDate,'day'),curr:day.date()===currDay&&day.month()===month,today:day.date()===today.date()&&day.month()===today.month()&&day.year()===today.year()})});return days}},{key:'next',value:function next(){var nextDate=this.props.dateVal.clone().add(1,'months');if(this.props.maxDate&&nextDate.isAfter(this.props.maxDate,'day')){nextDate=this.props.maxDate}this.props.cbSetDate(nextDate)}},{key:'prev',value:function prev(){var prevDate=this.props.dateVal.clone().subtract(1,'months');if(this.props.minDate&&prevDate.isBefore(this.props.minDate,'day')){prevDate=this.props.minDate}this.props.cbSetDate(prevDate)}},{key:'handleTitleClick',value:function handleTitleClick(type){switch(type){case'previous':this.prev();break;case'title':this.props.cbNextView();break;case'next':this.next();break;}}},{key:'daysOnKeyPress',value:function daysOnKeyPress(e){if(e.charCode=='13'){this.cellClick(e)}}},{key:'prefetchStyles',value:function prefetchStyles(){this.daysView=this.getStyle('daysView');this.lonerDays=this.getStyle('lonerDays');this.viewHeaderDayView=this.getStyle('viewHeaderDayView');this.daysWrapper=this.getStyle('daysWrapper')}},{key:'render',value:function render(){var _this2=this;var days=this.getDays().map(function(item,i){var _class=void 0;_class=(0,_classnames2.default)({day:true,next:item.next,prev:item.prev,current:item.curr,today:item.today});var style=void 0;if(_class.indexOf('prev')>-1||_class.indexOf('next')>-1){style={cellWrapper:_extends({},_this2.lonerDays)}}else{style=undefined}return _react2.default.createElement(_cell2.default,{classes:_class,key:i,isSelected:_class.indexOf('current')>-1,compStyle:style,dateVal:item.label})});return _react2.default.createElement('div',{className:'view days-view',style:this.daysView},_react2.default.createElement(_viewHeader2.default,{key:'ViewHeader - Day',headerData:this.currentDate,cbHeaderClick:this.handleTitleClick,compStyle:this.viewHeaderDayView}),_react2.default.createElement('div',{className:'days',tabIndex:0,onClick:this.cellClick,role:'button',style:this.daysWrapper,onKeyDown:this.daysOnKeyPress},days))}}]);return DayView}(_s2sBaseClass2.default);DayView.propTypes={cbNextView:_react2.default.PropTypes.func,cbSetDate:_react2.default.PropTypes.func,dateVal:_react2.default.PropTypes.object.isRequired,maxDate:_react2.default.PropTypes.object,minDate:_react2.default.PropTypes.object};DayView.defaultProps={cbNextView:undefined,cbSetDate:undefined,dateVal:{},minDate:(0,_moment2.default)().add(-10000,'days'),maxDate:(0,_moment2.default)().add(10000,'days')};exports.default=DayView;
