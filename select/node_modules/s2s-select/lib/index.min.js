'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactDom=require('react-dom');var _reactDom2=_interopRequireDefault(_reactDom);var _s2sBaseClass=require('s2s-base-class');var _s2sBaseClass2=_interopRequireDefault(_s2sBaseClass);var _s2sSvgIcons=require('s2s-svg-icons');var _immutable=require('immutable');var _styles=require('./styles.js');var _styles2=_interopRequireDefault(_styles);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Select=function(_BaseComponent){_inherits(Select,_BaseComponent);function Select(props){_classCallCheck(this,Select);var _this=_possibleConstructorReturn(this,(Select.__proto__||Object.getPrototypeOf(Select)).call(this,props));_this.displayName='Select';_this.state={isOpen:_this.props.isOpen,hasError:_this.props.hasError,hover:false,itemHovered:undefined,selectedItem:_this.props.defaultSelectedItem};_this.toggleSelect=_this.toggleSelect.bind(_this);_this.selectItem=_this.selectItem.bind(_this);_this.handleKeyDownMenu=_this.handleKeyDownMenu.bind(_this);_this.handleKeyDownDropDownItem=_this.handleKeyDownDropDownItem.bind(_this);_this.onBlurToggle=_this.onBlurToggle.bind(_this);_this.onItemHover=_this.onItemHover.bind(_this);_this.onMouseOut=_this.onMouseOut.bind(_this);_this.handleMouseEnter=_this.handleMouseEnter.bind(_this);_this.prefetchStyles();return _this}_createClass(Select,[{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){if(nextProps.hasOwnProperty('defaultSelectedItem')){this.setState(function(prevState,props){return _extends({},prevState,{selectedItem:nextProps.defaultSelectedItem})})}}},{key:'getDefaultStyle',value:function getDefaultStyle(styleName,objectPropState){//console.log('STYLENAME:::::',styleName)
return(0,_styles2.default)(styleName,objectPropState)}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(nextProps,nextState){return!(0,_immutable.fromJS)(nextProps).equals((0,_immutable.fromJS)(this.props))||!(0,_immutable.fromJS)(nextState).equals((0,_immutable.fromJS)(this.state))}},{key:'toggleSelect',value:function toggleSelect(){var _this2=this;this.setState(_extends({},this.state,{isOpen:!this.state.isOpen,hasError:false}));setTimeout(function(){_this2.props.cbOnClick()},0)}},{key:'selectItem',value:function selectItem(i){var _this3=this;// NOTE: This setTimeout is necessary so that selectedItem in state gets properly set.
setTimeout(function(){_this3.setState(_extends({},_this3.state,{selectedItem:i/*isOpen: !this.state.isOpen*/}));// NOTE: isOpen was removed because blurToggle and selectItem were both setting state and therefore not closing it.
},0);if(this.props.cbValueChanged){this.props.cbValueChanged(this.props.data[i])}}},{key:'onBlurToggle',value:function onBlurToggle(){if(this.state.isOpen){this.setState(_extends({},this.state,{isOpen:!this.state.isOpen}))}}},{key:'handleKeyDownMenu',value:function handleKeyDownMenu(e){switch(e.keyCode){case 32:// enter
this.toggleSelect();break;case 13:// spacebar
this.toggleSelect();break;case 40:// down arrow
this.toggleSelect();e.preventDefault();console.log(this.refs['item0']);//the down arrow needs to be pressed twice to successfuly move focus to the item in the list
_reactDom2.default.findDOMNode(this.refs['item0']).focus();this.setState(_extends({},this.state,{isOpen:true}));//this is to combat the quickness of the onblur function causeing the component to close
break;}}},{key:'handleKeyDownDropDownItem',value:function handleKeyDownDropDownItem(e,index){switch(e.keyCode){case 9:// tab
case 32:// enter
case 13:// spacebar
this.selectItem(index);break;case 40:// down arrow
if(_reactDom2.default.findDOMNode(this.refs['item'+index]).nextSibling){//The preventDefault() method cancels the event if it is cancelable // cancelling onBlurToggle
e.preventDefault();// findDOMNode finds dom with specific ref.
// nextSibling returns the next item
// focus gives focus to that next item
_reactDom2.default.findDOMNode(this.refs['item'+index]).nextSibling.focus();this.setState(_extends({},this.state,{isOpen:true}));//this is to combat the quickness of the onblur function causeing the component to close
}break;case 38:// up arrow
if(_reactDom2.default.findDOMNode(this.refs['item'+index]).previousSibling){e.preventDefault();_reactDom2.default.findDOMNode(this.refs['item'+index]).previousSibling.focus();this.setState(_extends({},this.state,{isOpen:true}));//this is to combat the quickness of the onblur function causeing the component to close
}break;}}},{key:'handleMouseEnter',value:function handleMouseEnter(){this.setState(_extends({},this.state,{'hover':true}))}// handleMouseLeave() {
//   this.setState({...this.state, 'hover': false});
// }
},{key:'setSelectStyle',value:function setSelectStyle(){var dynamicSelectStates=void 0;if(this.state.hover){dynamicSelectStates=this.state.isOpen?_extends({},this.containerStyleHover,this.containerStyleFocus):this.containerStyleHover}else{dynamicSelectStates=this.state.isOpen?_extends({},this.containerStyle,this.containerStyleFocus):this.containerStyle}if(this.state.hasError){dynamicSelectStates=_extends({},this.containerStyle,this.containerStyleError)}return dynamicSelectStates}},{key:'onItemHover',value:function onItemHover(item){if(!this.state.hover){this.setState(_extends({},this.state,{itemHovered:item,hover:true}))}}},{key:'onMouseOut',value:function onMouseOut(){if(this.state.hover){this.setState(_extends({},this.state,{'hover':false,itemHovered:undefined}))}}},{key:'renderSelectOptions',value:function renderSelectOptions(){var _this4=this;var selectItemStyle=void 0;return this.props.data.map(function(item,index){var divOnMouseOver=function divOnMouseOver(){_this4.onItemHover(item)};var divOnMouseLeave=function divOnMouseLeave(){_this4.onMouseOut(item)};var divOnMouseDown=function divOnMouseDown(){_this4.selectItem(index)};var divOnKeyDown=function divOnKeyDown(e){_this4.handleKeyDownDropDownItem(e,index)};if(item===_this4.state.itemHovered){selectItemStyle=_extends({},_this4.dropDownItem,{backgroundColor:_this4.state.hover?_this4.hoverBackgroundColor.backgroundColor:_this4.dropDownItem.backgroundColor})}else{selectItemStyle=_this4.dropDownItem}return _react2.default.createElement('div',{className:'option-'+index,'data-optionLabel':_this4.props.selectName+'-'+index,onMouseOver:divOnMouseOver,onMouseLeave:divOnMouseLeave,onMouseDown:divOnMouseDown,key:index,ref:'item'+index,onKeyDown:divOnKeyDown,role:'menuitem',style:selectItemStyle,tabIndex:'0'},item)})}},{key:'prefetchStyles',value:function prefetchStyles(){this.dropDown=this.getStyle('dropDown');this.menuOptionStyle=this.getStyle('menuOptionStyle');this.controlStyle=this.getStyle('controlStyle');this.selectStyle=this.getStyle('selectStyle');this.svgContainerStyle=this.getStyle('svgContainerStyle');this.svgStyles=this.getStyle('svgStyles');this.containerStyleHover=this.getStyle('containerStyleHover');this.containerStyle=this.getStyle('containerStyle');this.dropDownItem=this.getStyle('dropDownItem');this.hoverBackgroundColor=this.getStyle('hoverBackgroundColor');this.alertStyles=this.getStyle('alertStyles');this.alertSVGStyles=this.getStyle('alertSVGStyles');this.disabledSelectStyle=this.getStyle('disabledSelectStyle');this.containerStyleFocus=this.getStyle('containerStyleFocus');this.containerStyleError=this.getStyle('containerStyleError')}},{key:'render',value:function render(){var dropdownStyles=this.state.isOpen?_extends({},this.dropDown,{visibility:'visible'}):_extends({},this.dropDown,{visibility:'hidden'});var svgStyles=void 0;if(this.props.isDisabled){svgStyles=_extends({},this.svgStyles,{fill:'#ced4da'})}else{svgStyles=this.state.isOpen?_extends({},this.svgStyles,{fill:'#228ae6'}):_extends({},this.svgStyles)}var displayItems=_react2.default.createElement('div',{className:'displayItems',style:dropdownStyles,ref:'list'},this.renderSelectOptions());return _react2.default.createElement('div',{className:'wrapper',style:this.menuOptionStyle,onBlur:this.onBlurToggle},_react2.default.createElement('div',{className:'selectArea','data-selectLabel':this.props.selectName,style:this.setSelectStyle(),onMouseEnter:this.props.isDisabled?undefined:this.handleMouseEnter,onMouseLeave:this.props.isDisabled?undefined:this.onMouseOut},_react2.default.createElement('div',{style:this.controlStyle},_react2.default.createElement('div',{'aria-label':'drop down menu',style:this.props.isDisabled?this.disabledSelectStyle:this.selectStyle,role:'menu',tabIndex:'0',className:'dropDownMenu',ref:'dropDownMenu',onMouseDown:this.props.isDisabled?undefined:this.toggleSelect,'aria-haspopup':'true',onKeyDown:this.props.isDisabled?undefined:this.handleKeyDownMenu},_react2.default.createElement('div',{className:'defaultSelectedItem'},this.props.data[this.state.selectedItem]),_react2.default.createElement('span',{style:this.svgContainerStyle},_react2.default.createElement(_s2sSvgIcons.CaretDownIconSVG,{svgStyle:svgStyles}))))),!this.state.hasError?displayItems:_react2.default.createElement('div',{className:'errorArea',style:this.alertStyles},_react2.default.createElement(_s2sSvgIcons.AlertIconSVG,{svgStyle:this.alertSVGStyles}),_react2.default.createElement('div',{className:'errorText'},this.props.errorText)))}},{key:'value',get:function get(){return this.props.data[this.state.selectedItem]}}]);return Select}(_s2sBaseClass2.default);Select.thumbnail='data:image/png;base64,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';Select.displayName='Select';Select.propTypes={cbOnClick:_react2.default.PropTypes.func,cbValueChanged:_react2.default.PropTypes.func,compStyle:_react2.default.PropTypes.object,data:_react2.default.PropTypes.array,defaultSelectedItem:_react2.default.PropTypes.number,errorText:_react2.default.PropTypes.string,hasError:_react2.default.PropTypes.bool,isDisabled:_react2.default.PropTypes.bool,isOpen:_react2.default.PropTypes.bool,selectName:_react2.default.PropTypes.string,//this prop is for testability
itemsVisible:_react2.default.PropTypes.number// number of select options visible when select isOpen.
};Select.defaultProps={cbOnClick:function cbOnClick(){console.log('cbOnClick is not defined')},cbValueChanged:function cbValueChanged(){console.log('cbValueChanged is not defined')},data:['first item 1','second item 2'],defaultSelectedItem:0,errorText:'Please select an option from the dropdown',hasError:false,isDisabled:false,isOpen:false,itemsVisible:2};exports.default=Select;
